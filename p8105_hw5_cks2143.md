Homework 5
================
Chariz Seijo

## Problem 1

**Read in the data.**

``` r
homicide_df = 
  read_csv("data/homicide_data/homicide-data.csv") %>% 
  mutate(
    city_state = str_c(city, state, sep = "_"),
    resolved = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved",
    )
  ) %>% 
  select(city_state, resolved) %>% 
  filter(city_state != "Tulsa_AL")
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_double(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_character(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

**Data exploration**

``` r
aggregate_df = 
  homicide_df %>% 
  group_by(city_state) %>% 
  summarize(
    hom_total = n(),
    hom_unsolved = sum(resolved == "unsolved")
  )
```

    ## `summarise()` ungrouping output (override with `.groups` argument)

**Prop test for a single city**

``` r
prop.test(
  aggregate_df %>% filter(city_state == "Baltimore_MD") %>% pull(hom_unsolved), 
  aggregate_df %>% filter(city_state == "Baltimore_MD") %>% pull(hom_total)) %>% 
  broom::tidy()
```

    ## # A tibble: 1 x 8
    ##   estimate statistic  p.value parameter conf.low conf.high method    alternative
    ##      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr>     <chr>      
    ## 1    0.646      239. 6.46e-54         1    0.628     0.663 1-sampleâ€¦ two.sided

**Iteration**

``` r
results_df = 
  aggregate_df %>% 
  mutate(
    prop_tests = map2(.x = hom_unsolved, .y = hom_total, ~prop.test(x = .x, n = .y)),
    tidy_tests = map(.x = prop_tests, ~broom::tidy(.x))
  ) %>% 
  select(-prop_tests) %>% 
  unnest(tidy_tests) %>% 
  select(city_state, estimate, conf.low, conf.high)
```

``` r
results_df %>% 
  mutate(city_state = fct_reorder(city_state, estimate)) %>% 
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point() + 
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

<img src="p8105_hw5_cks2143_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" />

``` r
homicide_df = 
  read_csv("homicide_data/homicide-data.csv") %>% 
  mutate(
    city_state = str_c(city, state, sep = "_"),
    resolved = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved",
    )
  ) %>% 
  select(city_state, resolved) %>% 
  filter(city_state != "Tulsa_AL") %>% 
  nest(data = resolved)
```

    ## Error: 'homicide_data/homicide-data.csv' does not exist in current working directory ('/Users/mogl/Desktop/Current Classes/Data Science/HW 5/p8105_hw5_cks2143').

## Problem 2

**Create a tidy dataframe of the longitudinal data.**

``` r
path_df = 
  tibble(
    path = list.files("data/lda_data")) %>% 
    mutate(path = str_c("data/lda_data/", path))

lda_tidydf = 
  tibble(
    id = path_df$path,
    map_df(.x = path_df$path, ~read_csv(.x))
    ) %>% 
  mutate(
    id = substr(id, 15, 20)
    ) %>% 
  separate(id, c("group", "id")) %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week",
    names_prefix = "week_",
    values_to = "obsv"
    ) %>% 
  mutate(
    id = as.numeric(id),
    week = as.numeric(week)
    )
```

**Spaghetti plot of observations on each subject over time**

``` r
lda_tidydf %>% 
  ggplot(aes(x = week, y = obsv, group = interaction(id, group), color = group)) + 
    geom_line()
```

<img src="p8105_hw5_cks2143_files/figure-gfm/unnamed-chunk-6-1.png" width="90%" />

Based on the spaghetti plot, we can observe that observation values for
the experimental group are generally higher than the control group. The
experimental group shows some increase in values over time while the
control group remains relatively stable.
